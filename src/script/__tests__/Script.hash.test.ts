import { blake2b_224 } from "../../../crypto";
import * as uint8Array from "@harmoniclabs/uint8array-utils";
import { Hash28 } from "../../hashes/Hash28/Hash28";
import { Script, ScriptType } from "../Script"

describe("Script.hash", () => {

    test("", () => {

        const script = new Script(
            ScriptType.PlutusV2,
            uint8Array.fromHex(
                "5902045902010100003232323232323232323232323232323222330050012323233008002232323233300b00923300e2330113371e6eb8d55ce800801899198091aba335744002266e20dd69aab9e357420029000191bab00135573c0020064660206601c46601c00246466ebc004038d5d080080209980711980899b8f375c6aae7400400c4c8cc048d5d19aba200113370e6eb4d55cf1aba100148008c8dd58009aab9e0010033233333010005001001001232001375c6ae8400498c8dd580098078011980780a9bac3574200260280046ae8400530129d87982d87981582053df997f49216051d2e3e759a5497d8c933a923d9f97006b4a59102a9c30af5f000022232332533357346002900008018a999ab9a300148008401058dc39aab9d00135573c0026ea800c88c004d55cf1baa00223300824a24446600a60080042600600244a666ae68008528800912999ab9a00200114a04444464664a666ae68c005200010031533357346002900108020a999ab9a300148010401454ccd5cd1800a400c200c2c6e1cd55ce8009aab9e001375400a46ae84d5d11aba2357446ae880048cc00888cd5d0180180100080311198019001111198028011801800980091111919980398020009801800801198020018011191801119801001000918011198010010009112999aab9f0011003133002357420026ae88004dd8a4c400246ae84d5d10009"
            )
        );

        expect(
            script.hash.toString()
        ).toEqual("6c6bbc4f1b017a2173ec3be9851ac30a05c751a1e83bfc8a059cf805")
        
        const scriptFromFlat = new Script(
            ScriptType.PlutusV2,
            uint8Array.fromHex(
                "0100003232323232323232323232323232323222330050012323233008002232323233300b00923300e2330113371e6eb8d55ce800801899198091aba335744002266e20dd69aab9e357420029000191bab00135573c0020064660206601c46601c00246466ebc004038d5d080080209980711980899b8f375c6aae7400400c4c8cc048d5d19aba200113370e6eb4d55cf1aba100148008c8dd58009aab9e0010033233333010005001001001232001375c6ae8400498c8dd580098078011980780a9bac3574200260280046ae8400530129d87982d87981582053df997f49216051d2e3e759a5497d8c933a923d9f97006b4a59102a9c30af5f000022232332533357346002900008018a999ab9a300148008401058dc39aab9d00135573c0026ea800c88c004d55cf1baa00223300824a24446600a60080042600600244a666ae68008528800912999ab9a00200114a04444464664a666ae68c005200010031533357346002900108020a999ab9a300148010401454ccd5cd1800a400c200c2c6e1cd55ce8009aab9e001375400a46ae84d5d11aba2357446ae880048cc00888cd5d0180180100080311198019001111198028011801800980091111919980398020009801800801198020018011191801119801001000918011198010010009112999aab9f0011003133002357420026ae88004dd8a4c400246ae84d5d10009"
            )
        );

        expect(
            scriptFromFlat.hash.toString()
        ).toEqual("6c6bbc4f1b017a2173ec3be9851ac30a05c751a1e83bfc8a059cf805")
    });

    test("", () => {

        const hex = "01000032323232323232323232323232323232323232323222253335734666666666666444444444444660380024646464666660280040020024646604400a46464646604c01846464646464660586605a01200a46464660566604e9210131003375e01c00426604e92101320032323303100223232323303500723232323232323232323303b3303b3303b3303749010133003303f00d2323304100b23233303800323233303a0032323371e0060026eb8d5d08009250375c6ae840049281aba10013574200226606e9210134003001008133037491013500300100c133037491013600323233303601623303e3371266608042900011119b8048008c00c0040752004132323232323233044330443370e66e08018008cdc100180089919822998008030088998008028081119b873370400400866e0800c0044c8cccc0fc0548c8cdc39bad0013370000c0126ae8400400400498cdc000200199b8000e00d375a05866e0402402ccdc080480599981f80e8168161191981f9981f1981f9981da490137003375e01e66e9520043357400540742660769210138003303f357466ae880784cdc79bae35573a6ae840792210013303b49010139003574603c2660769201046d6174680033712a666ae68cdc4800a400026600601666e00028cdc199b8200702c4820225e84cc00ccdc000599b833370400c058904044bd005198018048041bad357420024464a666ae68cdc38018010800899822911919192999ab9a33041004001100113005001330023370066e08020014cdc1000a400866e00cdc119b810084800800ccdc1000a400c660026600200466e0801920043370400a900211b833370400400203266e00008004cdc1013a400846607246607866e3cdd71aab9d0010301323303d357466ae880044cdc39bad35573c6ae84005200237566aae78004004ccc0e80340b00acccc0e40300a40a0ccc0e00200a009cccc0dc01c0a40a0ccc0d8008098094ccc0d400409c098dd5981f8011aba1001303a003375660760046ae84004cc0c0cc0c40340208c8cc0c80048c8004dd5981d800981c80099818005803181b0011aba10013030005375a605c0086eb4c0bc00cdd698180011bad357420026eacc0a800cdd618150011bac357420026ae840040048c09d2410130003026002357420029111c268c3cbf595e83bcd35dc4ed6ae5b7d3fabd8a0ae672cdf1c38ca6de0048811c919d4c2c9455016289341b1a14dedf697687af31751170d56a31466e00488101580048811c0462de27174c88689ec9fe0e13777e1ed52285510300796e16b88acf00488101590048811c442466c188c388b757e804b442d553e95e27b9758f82b3f8e7be9ed8004881026c7100483c0b920c80100300200114985888888c8cc94ccd5cd1800a400020062a666ae68c005200210041533357346002900208028a999ab9a300148018401858dc39aab9d00135573c0026ea8014888c8cc94ccd5cd1800a400020062a666ae68c0052002100416370e6aae74004d55cf0009baa003222232332533357346002900008018a999ab9a300148008401054ccd5cd1800a4008200a2c6e1cd55ce8009aab9e00137540086ec526225333573400229444cd5ce001250223233006337120029001099b8948004004cdc080100091980290a512223300530040021300300122533357340042944004894ccd5cd0010008a5022233300421480008894ccd5cd19b8f375c6aae740080144ccc01c8520002225333573466e3cdd71aab9d0020071375a6aae780084c00c004dd59aab9e002130030010033004222232333006300400130030010023300400300222253335573e0020062660046ae84004d5d10009118009aab9e37540046002444a666ae68cc014d5d180119b88001480005854ccd5cd19b87480000044d5d08010998019aba200233700900080091918011198010010009180111980100100091199ab9a0024a200246ae84d5d11aba23574400246ae84d5d11aba2357446ae880048d5d09aba2357440024a66ae70004588d5d09aba200101";
        const buff = uint8Array.fromHex( hex );

        expect(
            new Hash28(
                new Uint8Array(
                    blake2b_224(
                        [ 0x02 ].concat( Array.from( buff ) ) as any
                    )
                )
            ).toString()
        ).toEqual("d0c458ca4f152152b592264e241e7097c947420d82752049f9036739");


    })
})